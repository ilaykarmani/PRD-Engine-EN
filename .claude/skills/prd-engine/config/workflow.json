{
  "workflow": {
    "name": "PRD-Engine",
    "version": "2.1.0",
    "description": "Multi-Agent PRD specification workflow â€” production level"
  },
  "agents": {
    "order": ["product-manager", "architect", "frontend"],
    "questions": {
      "product-manager": 9,
      "architect": 8,
      "frontend": 12
    },
    "frontend_note": "Q0 (reference) + Q1-Q11 (11 questions) = 12 interactions",
    "cross_review": true,
    "cross_review_after": "all_agents_complete",
    "cross_review_checks": [
      "pm_user_stories_coverage",
      "architect_technical_consistency",
      "frontend_ui_api_coverage",
      "analytics_events",
      "seo_metadata",
      "i18n_consistency",
      "deferred_documentation"
    ],
    "cross_review_checks_count": 7
  },
  "iron_rules": {
    "count": 18,
    "list": [
      "0: sub-agents sonnet only + DOC_SOURCE via sub-agent",
      "1: structured questions (AskUserQuestionTool + YAML)",
      "2: modularity â€” 500 lines max + agent separation",
      "3: save at key points only (agent complete, epic complete, /compact, session end)",
      "4: zero open ends + examples table",
      "5: Plan Mode before significant tasks",
      "6: Cross-Review 7 checks",
      "7: Sweet Spot (MVP/future/user decides)",
      "8: Epics = dev-ready output",
      "9: Diff before write",
      "10: holistic flexibility â€” SKILL questions = starting point",
      "11: self-improvement loop (lessons.md)",
      "12: DOC_SOURCE read every session",
      "13: PRD Context loading (prd-index.json)",
      "14: hat switching protocol",
      "15: Analytics Tracking (12+ events)",
      "16: Design System required",
      "17: Reflection at session end"
    ]
  },
  "step_zero": {
    "description": "Get source document link",
    "tool": "AskUserQuestionTool",
    "options": ["I have a link", "Not yet", "Spec from scratch"],
    "doc_source_rules": "READ-ONLY, download to local TXT, read from local file in subsequent sessions",
    "local_txt_optimization": {
      "enabled": true,
      "local_path": ".claude/memory/doc-source.txt",
      "flow": [
        "1. User provides link â†’ WebFetch document",
        "2. Convert to clean TXT â†’ save to doc-source.txt",
        "3. Update checkpoint: doc_local_path",
        "4. Epic Detection: sub-agent reads TXT, identifies potential epics",
        "5. Display epic list immediately â†’ 'Which epic should we start with?'"
      ],
      "benefits": [
        "Faster: no WebFetch every session",
        "Offline: works without internet",
        "Better UX: immediate epic detection"
      ]
    }
  },
  "output": {
    "parts": ["A", "B", "C", "D"],
    "part_a": "Business Requirements (PM) â€” 9 questions",
    "part_b": "Technical Architecture (Architect) â€” 8 questions",
    "part_c": "Frontend Specification (Frontend) â€” 11+prep questions",
    "part_d": "Cross-Review â€” 7 checks",
    "additional": "Key Decisions (All Agents)"
  },
  "navigation": {
    "commands": {
      "continue": "Continue to next question/agent",
      "back": "Go back to fix previous answer",
      "summary": "Show interim summary",
      "skip": "Skip to next agent (not recommended)"
    }
  },
  "saving": {
    "strategy": "key_points_only",
    "after_each_answer": false,
    "note": "â›” Do not save after every answer! Only at key points",
    "checkpoint_fields": ["epic", "agent", "question_number", "completed", "pending", "doc_source", "notes"],
    "saving_matrix": {
      "single_answer": {"checkpoint": false, "epic_file": false, "prd_index": false, "note": "Stored in memory only"},
      "agent_complete": {"checkpoint": true, "epic_file": true, "prd_index": false},
      "epic_100_percent": {"checkpoint": true, "epic_file": true, "prd_index": true},
      "compact_triggered": {"checkpoint": true, "epic_file": true, "prd_index": false},
      "session_end": {"checkpoint": true, "epic_file": true, "prd_index": false},
      "50_percent_context": {"checkpoint": true, "epic_file": true, "prd_index": false}
    },
    "save_triggers": ["agent_complete", "epic_complete", "/compact", "session_end", "50%_context"]
  },
  "sub_agents": {
    "model": "sonnet",
    "default_type": "Explore",
    "mandatory_scenarios": [
      {"scenario": "session start / after compact", "type": "Explore"},
      {"scenario": "reading DOC_SOURCE", "type": "Explore"},
      {"scenario": "checking cross-epic links", "type": "Explore"},
      {"scenario": "cross-review analysis", "type": "general-purpose"}
    ],
    "never_use_for": ["simple user questions", "continuing conversation"],
    "user_announcements": {
      "required": true,
      "before_template": "ðŸ”„ Sending sub-agent to {action}...",
      "after_template": "âœ… Sub-agent returned: {summary}",
      "examples": {
        "session_scan": {
          "before": "Sending sub-agent to scan all system files...",
          "after": "Found {epics} epics, {lessons} lessons, {entities} entities"
        },
        "doc_source": {
          "before": "Sending sub-agent to read requirements document...",
          "after": "Summary {lines} lines, {stories} user stories identified"
        },
        "cross_review": {
          "before": "Sending sub-agent to check consistency between agents...",
          "after": "{gaps} gaps found, {resolved} resolved"
        }
      }
    }
  },
  "quality": {
    "detail_level": "production",
    "note": "Every Part must be at full detail level â€” not a skeleton",
    "min_analytics_events": 12,
    "min_acceptance_criteria": 8,
    "max_file_lines": 500,
    "error_messages_bilingual": true,
    "design_system_required": true,
    "holistic_flexibility": true,
    "plan_mode_required_for_significant_tasks": true
  }
}
